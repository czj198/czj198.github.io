<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ­¦æ±‰äºŒæ‰‹æˆ¿æ•°æ®å¯è§†åŒ–+åˆ†æå»ºè®®ï¼ˆæé€ŸåŠ è½½ç‰ˆï¼‰</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; }
        #mapContainer { width: 100%; height: 100%; }
        
        /* åŠŸèƒ½é€‰é¡¹é¢æ¿ */
        #functionPanel {
            position: absolute;
            top: 20px;
            left: 20px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            width: 200px;
        }
        .function-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        .function-item {
            padding: 8px 0;
            color: #1e5799;
            cursor: pointer;
            border-bottom: 1px dashed #f0f0f0;
            transition: color 0.2s;
        }
        .function-item:hover {
            color: #16457a;
        }
        
        /* ç­›é€‰æŸ¥è¯¢é¢æ¿ */
        #filterSearchPanel {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            width: 320px;
        }
        .panel-title {
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            font-size: 16px;
            border-bottom: 1px solid #eee;
            padding-bottom: 8px;
        }
        .control-group {
            margin-bottom: 15px;
        }
        .control-label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
            color: #666;
        }
        .control-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
        .range-controls {
            display: flex;
            gap: 10px;
        }
        .range-controls input {
            flex: 1;
        }
        .action-button {
            width: 100%;
            padding: 10px;
            background: #1e5799;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            margin-bottom: 10px;
        }
        .action-button:hover {
            background: #16457a;
        }
        .action-button.reset {
            background: #666;
        }
        .result-count {
            font-size: 14px;
            color: #333;
            text-align: center;
            margin-top: 5px;
            padding-top: 10px;
            border-top: 1px dashed #eee;
        }

        /* å›¾ä¾‹ */
        #legend {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            min-width: 200px;
        }
        .legend-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 10px;
            border: 1px solid #fff;
            box-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }
        .legend-label {
            font-size: 14px;
            color: #666;
        }

        /* å­¦æ ¡å›¾ä¾‹ */
        #schoolLegend {
            position: absolute;
            bottom: 20px;
            left: 240px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            min-width: 180px;
        }
        .school-legend-box {
            width: 12px;
            height: 12px;
            margin-right: 10px;
            background-color: rgba(100, 149, 237, 0.2);
            border: 1px solid #6495ed;
        }
        .school-legend-icon {
            width: 12px;
            height: 12px;
            margin-right: 10px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%236495ed'%3E%3Cpath d='M5 13.18v4L12 21l7-3.82v-4L12 17l-7-3.82zM12 3L1 9l11 6 9-4.91V17h2V9L12 3z'/%3E%3C/svg%3E");
            background-size: contain;
        }

        /* å¼¹çª—é¢æ¿ï¼ˆä¼˜åŒ–åŠ è½½ï¼‰ */
        .popup-panel {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            z-index: 1002;
            width: 80%;
            max-width: 900px;
            max-height: 80vh;
            overflow-y: auto;
            display: none;
        }
        .popup-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        .popup-content img {
            width: 100%;
            border-radius: 4px;
            margin-bottom: 15px;
            /* å›¾ç‰‡åŠ è½½å¤±è´¥å…œåº• */
            background: #f5f5f5;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
        }
        .popup-content p {
            line-height: 1.6;
            color: #666;
            margin: 8px 0;
        }
        .popup-content .section-title {
            font-weight: bold;
            color: #1e5799;
            margin-top: 15px;
            margin-bottom: 8px;
        }
        .popup-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        .popup-buttons button {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
        }
        .popup-btn-suggest {
            background: #1e5799;
            color: white;
        }
        .popup-btn-close {
            background: #666;
            color: white;
        }
        /* å›¾ç‰‡åŠ è½½æç¤º */
        .img-loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #666;
            font-size: 14px;
        }
        .img-container {
            position: relative;
            width: 100%;
            margin-bottom: 15px;
        }

        /* å±æ€§é¢æ¿ */
        #propertyPanel {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            z-index: 1001;
            width: 300px;
            display: none;
        }
        .property-item {
            margin: 10px 0;
            padding: 5px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        .property-key {
            font-weight: bold;
            color: #1e5799;
        }

        /* åŠ è½½æç¤º */
        #loadingTip {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 15px 30px;
            border-radius: 8px;
            z-index: 2000;
        }

        /* æ–°å¢ï¼šç®¡ç†å‘˜ç™»å½•é¢æ¿ */
        #adminLoginPanel {
            position: absolute;
            top: 20px;
            left: 240px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            width: 200px;
        }
        .login-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
            font-size: 14px;
        }
        .login-input {
            width: 100%;
            padding: 6px 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 13px;
            box-sizing: border-box;
            margin-bottom: 8px;
        }
        .login-btn {
            width: 100%;
            padding: 6px;
            background: #1e5799;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 13px;
            cursor: pointer;
        }
        .login-status {
            font-size: 12px;
            color: #666;
            text-align: center;
            margin-top: 8px;
        }
        .login-success {
            color: #28a745;
        }
        .login-error {
            color: #dc3545;
        }

        /* æ–°å¢ï¼šè¯„ä»·é¢æ¿ */
        #commentPanel {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            z-index: 1003;
            width: 350px;
            display: none;
        }
        .comment-title {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        .comment-input {
            width: 100%;
            height: 80px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
            resize: none;
            margin-bottom: 10px;
        }
        .comment-score {
            margin-bottom: 10px;
        }
        .score-label {
            font-size: 14px;
            color: #666;
            margin-right: 10px;
        }
        .score-star {
            color: #ffc107;
            cursor: pointer;
        }
        .comment-submit {
            width: 100%;
            padding: 8px;
            background: #1e5799;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            margin-bottom: 15px;
        }
        .comment-list {
            max-height: 200px;
            overflow-y: auto;
            border-top: 1px solid #eee;
            padding-top: 10px;
        }
        .comment-item {
            padding: 8px 0;
            border-bottom: 1px dashed #f0f0f0;
        }
        .comment-score-display {
            color: #ffc107;
            margin-bottom: 4px;
        }
        .comment-content {
            font-size: 14px;
            color: #666;
            margin-bottom: 4px;
        }
        .comment-time {
            font-size: 12px;
            color: #999;
        }
        .comment-delete {
            font-size: 12px;
            color: #dc3545;
            cursor: pointer;
            margin-left: 10px;
            display: none; /* é»˜è®¤éšè—åˆ é™¤æŒ‰é’®ï¼Œç®¡ç†å‘˜ç™»å½•åæ˜¾ç¤º */
        }
        .admin-show .comment-delete {
            display: inline;
        }
        .comment-empty {
            font-size: 14px;
            color: #999;
            text-align: center;
            padding: 10px;
        }
    </style>
</head>
<body>
    <div id="mapContainer"></div>
    <div id="loadingTip">æ­£åœ¨åŠ è½½æ•°æ®...</div>
    
    <!-- åŠŸèƒ½é€‰é¡¹é¢æ¿ -->
    <div id="functionPanel">
        <div class="function-title">åˆ†æåŠŸèƒ½</div>
        <div class="function-item" onclick="openPopup('heatmap')">1. æˆ¿ä»·çƒ­åŠ›å›¾</div>
        <div class="function-item" onclick="openPopup('areaPrice')">2. å•ä»·é¢ç§¯å…³ç³»å›¾</div>
        <div class="function-item" onclick="openPopup('suggest')">3. è´­ä¹°å»ºè®®</div>
    </div>

    <!-- æ–°å¢ï¼šç®¡ç†å‘˜ç™»å½•é¢æ¿ -->
    <div id="adminLoginPanel">
        <div class="login-title">ç®¡ç†å‘˜ç™»å½•</div>
        <input type="text" id="adminAccount" class="login-input" placeholder="è´¦å·" value="">
        <input type="password" id="adminPwd" class="login-input" placeholder="å¯†ç " value="">
        <button class="login-btn" onclick="adminLogin()">ç™»å½•</button>
        <div class="login-status" id="loginStatus">æœªç™»å½•</div>
    </div>

    <!-- åŸæœ‰å›¾ä¾‹ -->
    <div id="legend">
        <div class="legend-title">å•ä»·å›¾ä¾‹</div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #ff0000;"></div>
            <div class="legend-label">å•ä»· > 10000å…ƒ/ã¡</div>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #0066cc;"></div>
            <div class="legend-label">å•ä»· â‰¤ 10000å…ƒ/ã¡</div>
        </div>
    </div>

    <!-- æ–°å¢ï¼šå­¦æ ¡å›¾ä¾‹ -->
    <div id="schoolLegend">
        <div class="legend-title">å­¦æ ¡æ ‡æ³¨</div>
        <div class="legend-item">
            <div class="school-legend-icon"></div>
            <div class="legend-label">å­¦æ ¡ä½ç½®</div>
        </div>
        <div class="legend-item">
            <div class="school-legend-box"></div>
            <div class="legend-label">å­¦æ ¡è¾å°„åŒºåŸŸ</div>
        </div>
    </div>
    
    <!-- ç­›é€‰æŸ¥è¯¢é¢æ¿ -->
    <div id="filterSearchPanel">
        <div class="panel-title">æ•°æ®æŸ¥è¯¢ä¸ç­›é€‰</div>
        <div class="control-group">
            <label class="control-label">å…³é”®è¯æŸ¥è¯¢ï¼ˆå°åŒº/åŒºåŸŸï¼‰</label>
            <input type="text" id="keywordSearch" class="control-input" placeholder="ä¾‹å¦‚ï¼šæ­¦æ˜ŒåŒºã€ä¸œæ¹–å°åŒº">
        </div>
        <div class="control-group">
            <label class="control-label">å•ä»·åŒºé—´ï¼ˆå…ƒ/ã¡ï¼‰</label>
            <div class="range-controls">
                <input type="number" id="minPrice" class="control-input" placeholder="æœ€ä½" min="0">
                <input type="number" id="maxPrice" class="control-input" placeholder="æœ€é«˜">
            </div>
        </div>
        <div class="control-group">
            <label class="control-label">æ€»ä»·åŒºé—´ï¼ˆä¸‡å…ƒï¼‰</label>
            <div class="range-controls">
                <input type="number" id="minTotalPrice" class="control-input" placeholder="æœ€ä½" min="0">
                <input type="number" id="maxTotalPrice" class="control-input" placeholder="æœ€é«˜">
            </div>
        </div>
        <div class="control-group">
            <label class="control-label">é¢ç§¯åŒºé—´ï¼ˆã¡ï¼‰</label>
            <div class="range-controls">
                <input type="number" id="minArea" class="control-input" placeholder="æœ€å°" min="0">
                <input type="number" id="maxArea" class="control-input" placeholder="æœ€å¤§">
            </div>
        </div>
        <button class="action-button" id="doSearchFilter">æŸ¥è¯¢å¹¶ç­›é€‰</button>
        <button class="action-button reset" id="resetAll">é‡ç½®æ‰€æœ‰æ¡ä»¶</button>
        <div class="result-count" id="resultCount">åŠ è½½ä¸­...</div>
    </div>

    <!-- æˆ¿ä»·çƒ­åŠ›å›¾å¼¹çª—ï¼ˆä¼˜åŒ–å›¾ç‰‡åŠ è½½ï¼‰ -->
    <div id="heatmapPopup" class="popup-panel">
        <div class="popup-title">æ­¦æ±‰å¸‚äºŒæ‰‹æˆ¿æˆ¿ä»·çƒ­åŠ›å›¾</div>
        <div class="popup-content">
            <div class="img-container">
                <div class="img-loading" id="heatmapLoading">å›¾ç‰‡åŠ è½½ä¸­...</div>
                <!-- æ–¹å¼1ï¼šä½¿ç”¨ä½ çš„åŸå›¾é“¾æ¥ï¼ˆä¼˜å…ˆï¼‰ -->
                <img 
                    src="https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/ff67be6eca864b2ca2d6ffb28ac6d54d.png~tplv-a9rns2rl98-image.png?rcl=202512161102294A53C7FE90AFCADC1108&rk3s=8e244e95&rrcfp=dafada99&x-expires=2082078150&x-signature=188tzcrtTDaIkY1ME2hI4dqYk8U%3D" 
                    alt="æ­¦æ±‰å¸‚äºŒæ‰‹æˆ¿æˆ¿ä»·çƒ­åŠ›å›¾"
                    onload="hideLoading('heatmapLoading')"
                    onerror="this.src='https://via.placeholder.com/800x600?text=å›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•'">
            </div>
            <div id="heatmapSuggest" style="display: none;">
                <div class="section-title">1. çƒ­åŠ›æ ¸å¿ƒåŒºï¼ˆçº¢è‰²é«˜å•ä»·ï¼‰</div>
                <p>ç¬¬ä¸€æ¢¯é˜Ÿï¼ˆ15000-20000 å…ƒ/ã¡ï¼‰ï¼šæ­¦æ˜Œæ»¨æ±Ÿï¼ˆç§¯ç‰æ¡¥ï¼‰ã€æ±Ÿå²¸äºŒä¸ƒæ»¨æ±Ÿã€æ±Ÿæ±‰æ­¦å¹¿å•†åœˆï¼Œæ ¸å¿ƒé©±åŠ¨ï¼šæ±Ÿæ™¯èµ„æº + é¡¶çº§å­¦åŒº + åœ°é“1/2/7å·çº¿ï¼›</p>
                <p>ç¬¬äºŒæ¢¯é˜Ÿï¼ˆ10000-15000 å…ƒ/ã¡ï¼‰ï¼šæ´ªå±±å…‰è°·ã€æ±‰é˜³é’Ÿå®¶æ‘ã€ç¡šå£å®—å…³ï¼Œæ ¸å¿ƒé©±åŠ¨ï¼šäº§ä¸šé›†èšï¼ˆå…‰è°·ç§‘åˆ›ï¼‰+ åœ°é“ç¯çº¿ + æˆç†Ÿå•†åœˆã€‚</p>
                
                <div class="section-title">2. å†·åŒºï¼ˆè“è‰²ä½å•ä»·ï¼‰</div>
                <p>æ ¸å¿ƒè¿œéƒŠï¼ˆ7000-10000 å…ƒ/ã¡ï¼‰ï¼šæ±Ÿå¤è—é¾™å²›ã€é»„é™‚ç›˜é¾™åŸã€ä¸œè¥¿æ¹–å´å®¶å±±ï¼Œæ ¸å¿ƒåˆ¶çº¦ï¼šé€šå‹¤è·ç¦»ï¼ˆè·å…‰è°·/æ±‰å£æ ¸å¿ƒï¼30åˆ†é’Ÿï¼‰+ é…å¥—æ»åï¼›</p>
                <p>è¿œéƒŠè¾¹ç¼˜ï¼ˆ5000-7000 å…ƒ/ã¡ï¼‰ï¼šæ–°æ´²é˜³é€»ã€è”¡ç”¸ä¸­æ³•ç”Ÿæ€åŸï¼Œæ ¸å¿ƒåˆ¶çº¦ï¼šæ— åœ°é“è¦†ç›– + äº§ä¸šæ”¯æ’‘å¼±ã€‚</p>
                
                <div class="section-title">3. çƒ­åŠ›åˆ†å¸ƒè§„å¾‹</div>
                <p>å•ä»·ä¸â€œæ ¸å¿ƒåŸåŒºè·ç¦»â€å‘ˆå¼ºè´Ÿç›¸å…³ï¼šè·æ±‰å£/æ­¦æ˜Œæ ¸å¿ƒæ¯å¢åŠ 5å…¬é‡Œï¼Œå•ä»·ä¸‹é™çº¦15%ï¼›</p>
                <p>åœ°é“æ²¿çº¿æº¢ä»·æ˜¾è‘—ï¼šå·²é€šè½¦åœ°é“ç«™ç‚¹500ç±³å†…æˆ¿æºï¼Œå•ä»·æ¯”éæ²¿çº¿é«˜10%-20%ï¼›</p>
                <p>å­¦åŒºæº¢ä»·åˆ†åŒ–ï¼šé‡ç‚¹å°å­¦ï¼ˆå¦‚æ­¦æ˜Œæ°´æœæ¹–ä¸€å°ï¼‰å­¦åŒºæˆ¿å•ä»·æº¢ä»·è¶…40%ï¼Œæ™®é€šå­¦åŒºæº¢ä»·ä»…5%-10%ã€‚</p>
            </div>
        </div>
        <div class="popup-buttons">
            <button class="popup-btn-suggest" onclick="toggleSuggest('heatmap')">æŸ¥çœ‹åˆ†æ</button>
            <button class="popup-btn-close" onclick="closePopup('heatmap')">å…³é—­</button>
        </div>
    </div>

    <!-- å•ä»·é¢ç§¯å…³ç³»å›¾å¼¹çª—ï¼ˆä¼˜åŒ–å›¾ç‰‡åŠ è½½ï¼‰ -->
    <div id="areaPricePopup" class="popup-panel">
        <div class="popup-title">å•ä»·å’Œé¢ç§¯ä¹‹é—´çš„å…³ç³»</div>
        <div class="popup-content">
            <div class="img-container">
                <div class="img-loading" id="areaPriceLoading">å›¾ç‰‡åŠ è½½ä¸­...</div>
                <!-- æ–¹å¼1ï¼šä½¿ç”¨ä½ çš„åŸå›¾é“¾æ¥ï¼ˆä¼˜å…ˆï¼‰ -->
                <img 
                    src="https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/40c76c2121c64120958d20d9c11059eb.png~tplv-a9rns2rl98-image.png?rcl=202512161102294A53C7FE90AFCADC1108&rk3s=8e244e95&rrcfp=dafada99&x-expires=2082078150&x-signature=LV0T3azWCNOUtVYOJv8EzWtQvmo%3D" 
                    alt="å•ä»·å’Œé¢ç§¯ä¹‹é—´çš„å…³ç³»"
                    onload="hideLoading('areaPriceLoading')"
                    onerror="this.src='https://via.placeholder.com/800x500?text=å›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•'">
            </div>
            <div id="areaPriceSuggest" style="display: none;">
                <p>å°æˆ·å‹å•ä»·æº¢ä»·æ˜¾è‘—ï¼š50-80ã¡æˆ¿æºé›†ä¸­åœ¨æ­¦æ˜Œã€æ±Ÿå²¸ç­‰æ ¸å¿ƒåŸåŒºï¼Œé…å¥—æˆç†Ÿï¼ˆåœ°é“/å­¦åŒºï¼‰ï¼Œå•ä»·æ¯”åŒåŒºåŸŸä¸­æˆ·å‹é«˜20%-30%ï¼Œæ ¸å¿ƒé€»è¾‘æ˜¯â€œä½æ€»ä»· + é«˜æµé€šæ€§â€ï¼›</p>
                <p>ä¸­æˆ·å‹æ€§ä»·æ¯”æœ€ä¼˜ï¼š80-120ã¡æ˜¯ä¾›éœ€å¹³è¡¡ç‚¹ï¼Œå•ä»·é€‚ä¸­ä¸”æ€»ä»·å¯æ§ï¼Œæ­¦æ˜Œæ´ªå±±ã€æ±‰é˜³å››æ–°ç­‰æ¿å—çš„æ¬¡æ–°æˆ¿å æ¯”è¶…70%ï¼Œå¢å€¼ç¨³å®šæ€§æœ€å¼ºï¼›</p>
                <p>å¤§æˆ·å‹å•ä»·æŠ˜ä»·æ˜æ˜¾ï¼š120ã¡ä»¥ä¸Šæˆ¿æºå¤šåˆ†å¸ƒåœ¨è¿œåŸåŒºï¼Œå•ä»·éšé¢ç§¯å¢å¤§é€æ­¥é™ä½ï¼Œæ ¸å¿ƒåˆ¶çº¦å› ç´ æ˜¯â€œç½®æ¢éš¾åº¦å¤§ + æŒæœ‰æˆæœ¬é«˜â€ã€‚</p>
            </div>
        </div>
        <div class="popup-buttons">
            <button class="popup-btn-suggest" onclick="toggleSuggest('areaPrice')">æŸ¥çœ‹åˆ†æ</button>
            <button class="popup-btn-close" onclick="closePopup('areaPrice')">å…³é—­</button>
        </div>
    </div>

    <!-- è´­ä¹°å»ºè®®å¼¹çª— -->
    <div id="suggestPopup" class="popup-panel">
        <div class="popup-title">æ­¦æ±‰å¸‚äºŒæ‰‹æˆ¿è´­ä¹°å»ºè®®</div>
        <div class="popup-content">
            <div class="section-title">1. åˆšéœ€è´­æˆ¿ï¼ˆé¢„ç®—æœ‰é™ï¼Œ50-80ã¡ï¼‰</div>
            <p>ä¼˜å…ˆæ¿å—ï¼šæ­¦æ˜Œå¾ä¸œã€æ±Ÿå²¸åæ¹–ã€æ±‰é˜³å››æ–°ï¼ˆå•ä»·10000-14000 å…ƒ/ã¡ï¼Œåœ°é“3/6/8å·çº¿è¦†ç›–ï¼Œå°æˆ·å‹å æ¯”è¶…60%ï¼‰ï¼›</p>
            <p>é¿å‘ç‚¹ï¼šè¿œç¦»æ ¸å¿ƒåŸåŒºè€ç ´å°ï¼ˆæˆ¿é¾„ï¼20å¹´ï¼Œæ— ç”µæ¢¯/ç‰©ä¸šå·®ï¼‰ï¼Œä¼˜å…ˆæ¬¡æ–°å°æˆ·å‹ï¼ˆæˆ¿é¾„5-10å¹´ï¼‰ï¼›</p>
            <p>æ ¸å¿ƒé€»è¾‘ï¼šç‰ºç‰²éƒ¨åˆ†é¢ç§¯ï¼Œä¼˜å…ˆä¿éšœâ€œåœ°é“ + å­¦åŒºâ€ï¼Œæµé€šæ€§ï¼å±…ä½èˆ’é€‚åº¦ã€‚</p>
            
            <div class="section-title">2. æ”¹å–„è´­æˆ¿ï¼ˆ80-120ã¡ï¼Œå…¼é¡¾æ€§ä»·æ¯”ä¸å±…ä½å“è´¨ï¼‰</div>
            <p>ä¼˜å…ˆæ¿å—ï¼šæ´ªå±±å…‰è°·ä¸œã€æ±‰é˜³é’Ÿå®¶æ‘ã€ç¡šå£æ±‰è¥¿ï¼ˆå•ä»·9000-12000 å…ƒ/ã¡ï¼Œä¸­æˆ·å‹å æ¯”70%ï¼Œæ¬¡æ–°æˆ¿ä¸ºä¸»ï¼‰ï¼›</p>
            <p>ä¼˜é€‰æˆ·å‹ï¼š3å®¤2å…ï¼ˆåŠŸèƒ½æ€§ï¼é¢ç§¯ï¼‰ï¼Œä¼˜å…ˆå—åŒ—é€šé€ã€æ¢¯æˆ·æ¯”1:2çš„æˆ¿æºï¼›</p>
            <p>æ ¸å¿ƒé€»è¾‘ï¼šä¸­æˆ·å‹æ˜¯ä¾›éœ€å¹³è¡¡ç‚¹ï¼Œå¢å€¼ç¨³å®šæ€§æœ€å¼ºï¼Œä¼˜å…ˆé€‰æ‹©â€œåœ°é“ + å•†ä¸š + å…¬å›­â€ä¸‰é‡é…å¥—æ¿å—ã€‚</p>
            
            <div class="section-title">3. é«˜ç«¯æ”¹å–„/æŠ•èµ„ï¼ˆ120-200ã¡ï¼‰</div>
            <p>ä¼˜å…ˆæ¿å—ï¼šæ­¦æ˜Œæ»¨æ±Ÿã€æ±Ÿå²¸äºŒä¸ƒæ»¨æ±Ÿï¼ˆå¤§æˆ·å‹å•ä»·12000-15000 å…ƒ/ã¡ï¼Œç¨€ç¼ºæ±Ÿæ™¯èµ„æºï¼‰ï¼Œè¿œåŸåŒºä»…æ¨èæ±Ÿå¤å…‰è°·å—ï¼ˆäº§ä¸šå¤–æº¢ï¼‰ï¼›</p>
            <p>é¿å‘ç‚¹ï¼šè¿œç¦»æ–°æ´²/è”¡ç”¸è¶…å¤§æˆ·å‹ï¼ˆæ¢æ‰‹ç‡ï¼œ5%/å¹´ï¼‰ï¼ŒæŠ•èµ„å±æ€§å¼±ï¼›</p>
            <p>æ ¸å¿ƒé€»è¾‘ï¼šåªé€‰æ ¸å¿ƒæ¿å—ç¨€ç¼ºèµ„æºï¼ˆæ±Ÿæ™¯/å­¦åŒºï¼‰ï¼Œé•¿æœŸæŒæœ‰ï¼ˆï¼5å¹´ï¼‰æ‰èƒ½å…‘ç°å¢å€¼ã€‚</p>
            
            <div class="section-title">4. çº¯æŠ•èµ„è´­æˆ¿</div>
            <p>ä¼˜å…ˆæ ‡çš„ï¼šå…‰è°·ä¸œ80-100ã¡æ¬¡æ–°æˆ¿ï¼ˆå•ä»·11000-13000 å…ƒ/ã¡ï¼Œäº§ä¸šäººå£å¯¼å…¥å¿«ï¼Œç§Ÿé‡‘å›æŠ¥ç‡2.5%-3%ï¼‰ï¼›</p>
            <p>é¿å‘æ ‡çš„ï¼šè¿œåŸåŒºä½å•ä»·å¤§æˆ·å‹ï¼ˆç§Ÿé‡‘å›æŠ¥ç‡ï¼œ1.5%ï¼Œæ¢æ‰‹ç‡ä½ï¼‰ï¼›</p>
            <p>æ ¸å¿ƒé€»è¾‘ï¼šæŠ•èµ„å›æŠ¥ç‡=ç§Ÿé‡‘æ”¶ç›Š + å¢å€¼æ”¶ç›Šï¼Œä¼˜å…ˆé€‰æ‹©â€œäº§ä¸šäººå£å¯¼å…¥å¿« + åœ°é“è§„åˆ’è½åœ°â€æ¿å—ã€‚</p>
            
            <div class="section-title">5. è¿œåŸåŒºè´­æˆ¿ï¼ˆå•ä»·â‰¤10000 å…ƒ/ã¡ï¼‰</div>
            <p>ä¼˜å…ˆæ¿å—ï¼šæ±Ÿå¤è—é¾™å²›ï¼ˆè¿‘å…‰è°·ï¼Œå•ä»·8000-10000 å…ƒ/ã¡ï¼‰ã€é»„é™‚ç›˜é¾™åŸï¼ˆè¿‘æ±‰å£ï¼Œå•ä»·7000-9000 å…ƒ/ã¡ï¼‰ï¼›</p>
            <p>æ ¸å¿ƒé…å¥—ï¼šä¼˜å…ˆé€‰æ‹©åœ°é“7/8/21å·çº¿æ²¿çº¿ï¼ˆå·²é€šè½¦ï¼‰ï¼Œé¿å¼€æ— åœ°é“è§„åˆ’æ¿å—ï¼›</p>
            <p>æ ¸å¿ƒé€»è¾‘ï¼šè¿œåŸåŒºè´­æˆ¿â€œåœ°é“ï¼ä»·æ ¼ï¼é¢ç§¯â€ï¼Œé€šå‹¤ä¾¿åˆ©æ€§æ˜¯ä¿å€¼æ ¸å¿ƒã€‚</p>
        </div>
        <div class="popup-buttons">
            <button class="popup-btn-close" onclick="closePopup('suggest')">å…³é—­</button>
        </div>
    </div>

    <!-- å±æ€§é¢æ¿ -->
    <div id="propertyPanel">
        <div class="property-item">
            <span class="property-key">å°åŒº:</span> <span id="propCommunity"></span>
        </div>
        <div class="property-item">
            <span class="property-key">åŒºåŸŸ:</span> <span id="propRegion"></span>
        </div>
        <div class="property-item">
            <span class="property-key">æˆ¿å‹:</span> <span id="propLayout"></span>
        </div>
        <div class="property-item">
            <span class="property-key">é¢ç§¯:</span> <span id="propArea"></span> ã¡
        </div>
        <div class="property-item">
            <span class="property-key">å•ä»·:</span> <span id="propUnitPrice"></span> å…ƒ/ã¡
        </div>
        <div class="property-item">
            <span class="property-key">æ€»ä»·:</span> <span id="propTotalPrice"></span> ä¸‡å…ƒ
        </div>
        <button class="action-button" style="margin-top:10px" onclick="openCommentPanel(currentSelectedPoint)">æ·»åŠ è¯„ä»·</button>
        <button class="action-button reset" onclick="document.getElementById('propertyPanel').style.display='none'">å…³é—­</button>
    </div>

    <!-- æ–°å¢ï¼šè¯„ä»·é¢æ¿ -->
    <div id="commentPanel">
        <div class="comment-title" id="commentPanelTitle">è¯„ä»· - <span id="commentCommunityName"></span></div>
        <div class="comment-score">
            <span class="score-label">è¯„åˆ†ï¼š</span>
            <span class="score-star" onclick="setScore(1)">â˜…</span>
            <span class="score-star" onclick="setScore(2)">â˜…</span>
            <span class="score-star" onclick="setScore(3)">â˜…</span>
            <span class="score-star" onclick="setScore(4)">â˜…</span>
            <span class="score-star" onclick="setScore(5)">â˜…</span>
            <input type="hidden" id="currentScore" value="0">
        </div>
        <textarea class="comment-input" id="commentContent" placeholder="è¯·è¾“å…¥è¯„ä»·å†…å®¹..."></textarea>
        <button class="comment-submit" onclick="submitComment()">æäº¤è¯„ä»·</button>
        <div class="comment-list" id="commentList">
            <div class="comment-empty">æš‚æ— è¯„ä»·</div>
        </div>
        <div class="popup-buttons" style="margin-top:15px">
            <button class="popup-btn-close" onclick="closeCommentPanel()">å…³é—­</button>
        </div>
    </div>

    <!-- é«˜å¾·å®‰å…¨é…ç½® -->
    <script type="text/javascript">
        window._AMapSecurityConfig = {
            securityJsCode: '7e5f2c0059d4114aa0a0141f0182b0c1'
        };
    </script>

    <!-- å¼•å…¥é«˜å¾·åœ°å›¾API -->
    <script type="text/javascript" src="https://webapi.amap.com/maps?v=2.0&key=a19e8b46119d6277b2f366ab1d2f552c&plugin=AMap.DataService,AMap.DistrictSearch"></script>
    
    <script type="text/javascript">
        // åˆå§‹åŒ–åœ°å›¾
        var map = new AMap.Map('mapContainer', {
            zoom: 12,
            center: [114.305, 30.593]
        });

        // å…¨å±€å˜é‡
        var allDataPoints = [];
        var currentMarkers = [];
        var currentSelectedPoint = null; // å½“å‰é€‰ä¸­çš„ç‚¹ä½
        var isAdmin = false; // æ˜¯å¦ç®¡ç†å‘˜ç™»å½•
        var commentData = {}; // å­˜å‚¨è¯„ä»·æ•°æ® {ç‚¹ä½ID: [{score: 5, content: 'è¯„ä»·å†…å®¹', time: 'æ—¶é—´æˆ³', id: 'è¯„è®ºID'}]}
        var schoolMarkers = []; // å­¦æ ¡æ ‡è®°æ•°ç»„
        var schoolPolygons = []; // å­¦æ ¡åŒºåŸŸå¤šè¾¹å½¢æ•°ç»„

        // æ­¦æ±‰ä¸»è¦å­¦æ ¡æ•°æ®ï¼ˆåŒ…å«åæ ‡å’Œè¾å°„èŒƒå›´ï¼‰
        var wuhanSchools = [
            {
                name: "æ­¦æ±‰å¤§å­¦ï¼ˆæ–‡ç†å­¦éƒ¨ï¼‰",
                lnglat: [114.3517, 30.5422],
                radius: 0.008 // è¾å°„åŠå¾„ï¼ˆç»çº¬åº¦ï¼‰
            },
            {
                name: "åä¸­ç§‘æŠ€å¤§å­¦ï¼ˆä¸»æ ¡åŒºï¼‰",
                lnglat: [114.4002, 30.5087],
                radius: 0.010
            },
            {
                name: "åä¸­å¸ˆèŒƒå¤§å­¦",
                lnglat: [114.3589, 30.5236],
                radius: 0.007
            },
            {
                name: "æ­¦æ±‰ç†å·¥å¤§å­¦ï¼ˆé©¬æˆ¿å±±æ ¡åŒºï¼‰",
                lnglat: [114.3678, 30.5058],
                radius: 0.008
            },
            {
                name: "ä¸­å—è´¢ç»æ”¿æ³•å¤§å­¦ï¼ˆå—æ¹–æ ¡åŒºï¼‰",
                lnglat: [114.3876, 30.4759],
                radius: 0.009
            },
            {
                name: "æ°´æœæ¹–ç¬¬ä¸€å°å­¦",
                lnglat: [114.3278, 30.5789],
                radius: 0.005
            },
            {
                name: "æ­¦æ±‰å¤–å›½è¯­å­¦æ ¡",
                lnglat: [114.2056, 30.5678],
                radius: 0.006
            },
            {
                name: "åä¸­å¸ˆå¤§ä¸€é™„ä¸­",
                lnglat: [114.4567, 30.4892],
                radius: 0.007
            },
            {
                name: "æ­¦æ±‰äºŒä¸­",
                lnglat: [114.3215, 30.6087],
                radius: 0.005
            },
            {
                name: "æ­¦æ±‰å…­ä¸­",
                lnglat: [114.3128, 30.6015],
                radius: 0.005
            }
        ];

        // é¡µé¢åŠ è½½å®ŒæˆååŠ è½½æ•°æ®
        window.onload = async function() {
            await loadBackupMockData(); 
            initSearchFilterControls();
            // æ·»åŠ å­¦æ ¡æ ‡æ³¨å’Œè¾å°„åŒºåŸŸ
            addSchoolMarkers();
            document.getElementById('loadingTip').style.display = 'none';
            
            // é¢„åŠ è½½å›¾ç‰‡ï¼ˆå…³é”®ä¼˜åŒ–ï¼šæå‰åŠ è½½å›¾ç‰‡åˆ°ç¼“å­˜ï¼‰
            preloadImages([
                'https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/ff67be6eca864b2ca2d6ffb28ac6d54d.png~tplv-a9rns2rl98-image.png?rcl=202512161102294A53C7FE90AFCADC1108&rk3s=8e244e95&rrcfp=dafada99&x-expires=2082078150&x-signature=188tzcrtTDaIkY1ME2hI4dqYk8U%3D',
                'https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/40c76c2121c64120958d20d9c11059eb.png~tplv-a9rns2rl98-image.png?rcl=202512161102294A53C7FE90AFCADC1108&rk3s=8e244e95&rrcfp=dafada99&x-expires=2082078150&x-signature=LV0T3azWCNOUtVYOJv8EzWtQvmo%3D'
            ]);
        };

        // æ·»åŠ å­¦æ ¡æ ‡æ³¨å’Œè¾å°„åŒºåŸŸ
        function addSchoolMarkers() {
            // æ¸…é™¤ç°æœ‰å­¦æ ¡æ ‡è®°
            clearSchoolMarkers();
            
            wuhanSchools.forEach(function(school) {
                // åˆ›å»ºå­¦æ ¡æ ‡è®°
                var schoolIcon = `<div style="
                    width: 16px;
                    height: 16px;
                    background-color: #6495ed;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    color: white;
                    font-size: 8px;
                    border: 2px solid white;
                    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
                ">ğŸ«</div>`;
                
                var marker = new AMap.Marker({
                    position: school.lnglat,
                    title: school.name,
                    content: schoolIcon,
                    offset: new AMap.Pixel(-8, -8),
                    zIndex: 100 // ç¡®ä¿å­¦æ ¡æ ‡è®°åœ¨æˆ¿æºæ ‡è®°ä¹‹ä¸Š
                });
                
                marker.on('click', function() {
                    // ç‚¹å‡»å­¦æ ¡æ ‡è®°æ˜¾ç¤ºä¿¡æ¯
                    var infoWindow = new AMap.InfoWindow({
                        content: `<div style="padding: 10px;"><strong>${school.name}</strong></div>`,
                        offset: new AMap.Pixel(0, -20)
                    });
                    infoWindow.open(map, school.lnglat);
                });
                
                marker.setMap(map);
                schoolMarkers.push(marker);
                
                // åˆ›å»ºå­¦æ ¡è¾å°„åŒºåŸŸï¼ˆæ·¡è“è‰²é€æ˜å¤šè¾¹å½¢ï¼‰
                var polygonPoints = getCirclePoints(school.lnglat, school.radius, 32);
                var polygon = new AMap.Polygon({
                    path: polygonPoints,
                    fillColor: '#6495ed', // æ·¡è“è‰²
                    fillOpacity: 0.1, // é€æ˜åº¦10%ï¼Œä¸å½±å“è§‚æ„Ÿ
                    strokeColor: '#6495ed',
                    strokeOpacity: 0.3,
                    strokeWeight: 1,
                    zIndex: 50 // ç¡®ä¿åŒºåŸŸåœ¨æˆ¿æºæ ‡è®°ä¹‹ä¸‹
                });
                
                polygon.setMap(map);
                schoolPolygons.push(polygon);
            });
        }

        // ç”Ÿæˆåœ†å½¢å¤šè¾¹å½¢çš„é¡¶ç‚¹
        function getCirclePoints(center, radius, numPoints) {
            var points = [];
            var lng = center[0];
            var lat = center[1];
            
            for (var i = 0; i < numPoints; i++) {
                var angle = (i / numPoints) * Math.PI * 2;
                var newLng = lng + radius * Math.cos(angle);
                var newLat = lat + radius * Math.sin(angle);
                points.push([newLng, newLat]);
            }
            
            return points;
        }

        // æ¸…é™¤å­¦æ ¡æ ‡è®°
        function clearSchoolMarkers() {
            schoolMarkers.forEach(marker => marker.setMap(null));
            schoolPolygons.forEach(polygon => polygon.setMap(null));
            schoolMarkers = [];
            schoolPolygons = [];
        }

        // é¢„åŠ è½½å›¾ç‰‡ï¼ˆæ ¸å¿ƒä¼˜åŒ–ï¼‰
        function preloadImages(imageUrls) {
            imageUrls.forEach(url => {
                const img = new Image();
                img.src = url;
                // åŠ è½½å®Œæˆåå­˜å…¥ç¼“å­˜ï¼Œåç»­æ‰“å¼€å¼¹çª—ç›´æ¥è¯»å–
                img.onload = function() {
                    console.log('å›¾ç‰‡é¢„åŠ è½½å®Œæˆï¼š', url);
                };
                img.onerror = function() {
                    console.warn('å›¾ç‰‡é¢„åŠ è½½å¤±è´¥ï¼š', url);
                };
            });
        }

        // éšè—å›¾ç‰‡åŠ è½½æç¤º
        function hideLoading(loadingId) {
            document.getElementById(loadingId).style.display = 'none';
        }

        // åŠ è½½æ¨¡æ‹Ÿæ•°æ®
        function loadBackupMockData() {
            var wuhanRegions = ['æ±Ÿå²¸åŒº', 'æ±Ÿæ±‰åŒº', 'ç¡šå£åŒº', 'æ±‰é˜³åŒº', 'æ­¦æ˜ŒåŒº', 'é’å±±åŒº', 'æ´ªå±±åŒº'];
            var communityNames = [
                'ä¸œæ¹–å¤©ä¸‹', 'ä¿åˆ©å¿ƒè¯­', 'ç™¾æ­¥äº­èŠ±å›­', 'ä¸‡ç§‘é‡‘è‰²åŸå¸‚', 'åæ¶¦ç½®åœ°æ©¡æ ‘æ¹¾',
                'é‡‘åœ°è‡ªåœ¨åŸ', 'ç¦æ˜Ÿæƒ èª‰å›½é™…åŸ', 'ç»¿åœ°å›½é™…é‡‘èåŸ', 'èåˆ›æœ›æ±Ÿåºœ', 'ä¸­å»ºå¤§å…¬é¦†'
            ];
            var layouts = ['2å®¤1å…', '3å®¤1å…', '3å®¤2å…', '4å®¤2å…', '2å®¤2å…'];
            
            for (var i = 0; i < 159; i++) {
                var region = wuhanRegions[Math.floor(Math.random() * wuhanRegions.length)];
                var community = communityNames[i % communityNames.length] + (i < 10 ? '' : i);
                var unitPrice = Math.floor(Math.random() * 15000) + 5000;
                var area = Math.floor(Math.random() * 150) + 50;
                var totalPrice = (unitPrice * area / 10000).toFixed(2);
                
                allDataPoints.push({
                    id: i + 1,
                    å°åŒº: community,
                    åŒºåŸŸ: region,
                    æˆ¿å‹: layouts[Math.floor(Math.random() * layouts.length)],
                    é¢ç§¯: area,
                    å•ä»·: unitPrice,
                    æ€»ä»·: parseFloat(totalPrice),
                    lnglat: [114.2 + Math.random() * 0.3, 30.5 + Math.random() * 0.2],
                    color: unitPrice > 10000 ? '#ff0000' : '#0066cc'
                });
                // åˆå§‹åŒ–è¯„ä»·æ•°æ®
                commentData[i + 1] = [];
            }
            
            showDataPoints(allDataPoints);
            updateResultCount(allDataPoints.length);
        }

        // æ˜¾ç¤ºæ•°æ®ç‚¹
        function showDataPoints(points) {
            clearMarkers();
            points.forEach(function(point) {
                if (!point.lnglat || point.lnglat.length !== 2) return;
                
                var markerContent = `<div style="
                    width: 10px;          
                    height: 10px;         
                    background-color: ${point.color};
                    border-radius: 50%;   
                    border: 1px solid #fff; 
                    box-shadow: 0 1px 2px rgba(0,0,0,0.2); 
                    cursor: pointer;
                    transition: transform 0.2s ease; 
                    z-index: 70;
                " 
                onmouseover="this.style.transform='scale(1.5)'"  
                onmouseout="this.style.transform='scale(1)'"
                title="${point.å°åŒº} - ${point.åŒºåŸŸ} - ${point.å•ä»·}å…ƒ/ã¡"></div>`;
                
                var marker = new AMap.Marker({
                    position: point.lnglat,
                    title: `${point.å°åŒº}ï¼ˆ${point.åŒºåŸŸ}ï¼‰- ${point.å•ä»·}å…ƒ/ã¡`,
                    content: markerContent,
                    offset: new AMap.Pixel(-5, -5),
                    zIndex: 70 // æˆ¿æºæ ‡è®°å±‚çº§
                });
                
                marker.on('click', function() {
                    showPropertyInfo(point);
                    currentSelectedPoint = point; // è®°å½•å½“å‰é€‰ä¸­çš„ç‚¹ä½
                });
                
                marker.setMap(map);
                currentMarkers.push(marker);
            });
        }

        // æ¸…é™¤æ ‡è®°
        function clearMarkers() {
            currentMarkers.forEach(marker => marker.setMap(null));
            currentMarkers = [];
        }

        // æ˜¾ç¤ºå±æ€§ä¿¡æ¯
        function showPropertyInfo(point) {
            document.getElementById('propCommunity').textContent = point.å°åŒº;
            document.getElementById('propRegion').textContent = point.åŒºåŸŸ;
            document.getElementById('propLayout').textContent = point.æˆ¿å‹;
            document.getElementById('propArea').textContent = point.é¢ç§¯;
            document.getElementById('propUnitPrice').textContent = point.å•ä»·;
            document.getElementById('propTotalPrice').textContent = point.æ€»ä»·;
            document.getElementById('propertyPanel').style.display = 'block';
        }

        // åˆå§‹åŒ–ç­›é€‰æ§ä»¶
        function initSearchFilterControls() {
            document.getElementById('doSearchFilter').addEventListener('click', executeSearchAndFilter);
            document.getElementById('resetAll').addEventListener('click', resetAllConditions);
            document.getElementById('keywordSearch').addEventListener('keyup', function(e) {
                if (e.key === 'Enter') executeSearchAndFilter();
            });
        }

        // æ‰§è¡Œç­›é€‰
        function executeSearchAndFilter() {
            if (allDataPoints.length === 0) {
                alert('æš‚æ— æ•°æ®å¯ç­›é€‰ï¼');
                return;
            }

            var keyword = document.getElementById('keywordSearch').value.trim().toLowerCase();
            var minPrice = parseFloat(document.getElementById('minPrice').value) || 0;
            var maxPrice = parseFloat(document.getElementById('maxPrice').value) || Infinity;
            var minTotalPrice = parseFloat(document.getElementById('minTotalPrice').value) || 0;
            var maxTotalPrice = parseFloat(document.getElementById('maxTotalPrice').value) || Infinity;
            var minArea = parseFloat(document.getElementById('minArea').value) || 0;
            var maxArea = parseFloat(document.getElementById('maxArea').value) || Infinity;

            var filteredPoints = allDataPoints.filter(point => {
                var keywordMatch = keyword === '' 
                    ? true 
                    : point.å°åŒº.toLowerCase().includes(keyword) || point.åŒºåŸŸ.toLowerCase().includes(keyword);
                var priceMatch = point.å•ä»· >= minPrice && point.å•ä»· <= maxPrice;
                var totalPriceMatch = point.æ€»ä»· >= minTotalPrice && point.æ€»ä»· <= maxTotalPrice;
                var areaMatch = point.é¢ç§¯ >= minArea && point.é¢ç§¯ <= maxArea;
                return keywordMatch && priceMatch && totalPriceMatch && areaMatch;
            });

            showDataPoints(filteredPoints);
            updateResultCount(filteredPoints.length);
            if (filteredPoints.length === 0) alert('æœªæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„æ•°æ®ï¼');
        }

        // é‡ç½®ç­›é€‰
        function resetAllConditions() {
            document.getElementById('keywordSearch').value = '';
            document.getElementById('minPrice').value = '';
            document.getElementById('maxPrice').value = '';
            document.getElementById('minTotalPrice').value = '';
            document.getElementById('maxTotalPrice').value = '';
            document.getElementById('minArea').value = '';
            document.getElementById('maxArea').value = '';
            showDataPoints(allDataPoints);
            updateResultCount(allDataPoints.length);
        }

        // æ›´æ–°ç»“æœè®¡æ•°
        function updateResultCount(count) {
            document.getElementById('resultCount').textContent = 
                count === 0 ? 'æš‚æ— æ•°æ®' : 
                count === allDataPoints.length ? `å…± ${count} ä¸ªæ•°æ®ç‚¹` : 
                `ç­›é€‰ç»“æœï¼š${count} ä¸ªæ•°æ®ç‚¹`;
        }

        // å¼¹çª—ç›¸å…³åŠŸèƒ½
        function openPopup(type) {
            // éšè—æ‰€æœ‰å¼¹çª—
            document.querySelectorAll('.popup-panel').forEach(panel => panel.style.display = 'none');
            // æ˜¾ç¤ºå¯¹åº”å¼¹çª—
            if (type === 'heatmap') {
                document.getElementById('heatmapPopup').style.display = 'block';
                // é‡ç½®åŠ è½½æç¤º
                document.getElementById('heatmapLoading').style.display = 'block';
            }
            if (type === 'areaPrice') {
                document.getElementById('areaPricePopup').style.display = 'block';
                // é‡ç½®åŠ è½½æç¤º
                document.getElementById('areaPriceLoading').style.display = 'block';
            }
            if (type === 'suggest') document.getElementById('suggestPopup').style.display = 'block';
        }

        function closePopup(type) {
            if (type === 'heatmap') document.getElementById('heatmapPopup').style.display = 'none';
            if (type === 'areaPrice') document.getElementById('areaPricePopup').style.display = 'none';
            if (type === 'suggest') document.getElementById('suggestPopup').style.display = 'none';
            // å…³é—­æ—¶éšè—åˆ†æå†…å®¹
            document.getElementById('heatmapSuggest').style.display = 'none';
            document.getElementById('areaPriceSuggest').style.display = 'none';
        }

        function toggleSuggest(type) {
            if (type === 'heatmap') {
                var elem = document.getElementById('heatmapSuggest');
                elem.style.display = elem.style.display === 'none' ? 'block' : 'none';
            }
            if (type === 'areaPrice') {
                var elem = document.getElementById('areaPriceSuggest');
                elem.style.display = elem.style.display === 'none' ? 'block' : 'none';
            }
        }

        // ==================== æ–°å¢ï¼šç®¡ç†å‘˜ç™»å½•åŠŸèƒ½ ====================
        function adminLogin() {
            const account = document.getElementById('adminAccount').value.trim();
            const pwd = document.getElementById('adminPwd').value.trim();
            const statusEl = document.getElementById('loginStatus');

            if (account === '123456' && pwd === '13456') {
                isAdmin = true;
                statusEl.className = 'login-status login-success';
                statusEl.textContent = 'å·²ç™»å½•ï¼ˆç®¡ç†å‘˜ï¼‰';
                document.getElementById('commentList').classList.add('admin-show');
                alert('ç®¡ç†å‘˜ç™»å½•æˆåŠŸï¼Œå·²è§£é”è¯„è®ºåˆ é™¤åŠŸèƒ½ï¼');
            } else {
                isAdmin = false;
                statusEl.className = 'login-status login-error';
                statusEl.textContent = 'è´¦å·æˆ–å¯†ç é”™è¯¯';
                document.getElementById('commentList').classList.remove('admin-show');
            }
        }

        // ==================== æ–°å¢ï¼šè¯„ä»·åŠŸèƒ½ ====================
        // æ‰“å¼€è¯„ä»·é¢æ¿
        function openCommentPanel(point) {
            if (!point) {
                alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæˆ¿æºç‚¹ä½ï¼');
                return;
            }
            currentSelectedPoint = point;
            document.getElementById('commentCommunityName').textContent = point.å°åŒº;
            document.getElementById('commentPanel').style.display = 'block';
            // é‡ç½®è¯„åˆ†å’Œè¾“å…¥æ¡†
            resetScore();
            document.getElementById('commentContent').value = '';
            // åŠ è½½è¯¥ç‚¹ä½çš„è¯„ä»·
            loadComments(point.id);
            // ç®¡ç†å‘˜ç™»å½•çŠ¶æ€æ›´æ–°
            if (isAdmin) {
                document.getElementById('commentList').classList.add('admin-show');
            } else {
                document.getElementById('commentList').classList.remove('admin-show');
            }
        }

        // å…³é—­è¯„ä»·é¢æ¿
        function closeCommentPanel() {
            document.getElementById('commentPanel').style.display = 'none';
        }

        // è®¾ç½®è¯„åˆ†
        function setScore(score) {
            document.getElementById('currentScore').value = score;
            const stars = document.querySelectorAll('.score-star');
            stars.forEach((star, index) => {
                star.style.color = index < score ? '#ffc107' : '#ccc';
            });
        }

        // é‡ç½®è¯„åˆ†
        function resetScore() {
            document.getElementById('currentScore').value = 0;
            const stars = document.querySelectorAll('.score-star');
            stars.forEach(star => {
                star.style.color = '#ccc';
            });
        }

        // æäº¤è¯„ä»·
        function submitComment() {
            if (!currentSelectedPoint) {
                alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæˆ¿æºç‚¹ä½ï¼');
                return;
            }
            const score = parseInt(document.getElementById('currentScore').value);
            const content = document.getElementById('commentContent').value.trim();
            
            if (score === 0) {
                alert('è¯·é€‰æ‹©è¯„åˆ†ï¼');
                return;
            }
            if (!content) {
                alert('è¯·è¾“å…¥è¯„ä»·å†…å®¹ï¼');
                return;
            }

            // ç”Ÿæˆè¯„è®ºID
            const commentId = 'cmt_' + Date.now() + '_' + Math.floor(Math.random() * 1000);
            // æ„é€ è¯„è®ºæ•°æ®
            const comment = {
                id: commentId,
                score: score,
                content: content,
                time: new Date().toLocaleString()
            };

            // ä¿å­˜è¯„è®º
            commentData[currentSelectedPoint.id].push(comment);
            // é‡æ–°åŠ è½½è¯„è®º
            loadComments(currentSelectedPoint.id);
            // é‡ç½®è¡¨å•
            resetScore();
            document.getElementById('commentContent').value = '';
            alert('è¯„ä»·æäº¤æˆåŠŸï¼');
        }

        // åŠ è½½è¯„è®º
        function loadComments(pointId) {
            const commentListEl = document.getElementById('commentList');
            const comments = commentData[pointId] || [];

            if (comments.length === 0) {
                commentListEl.innerHTML = '<div class="comment-empty">æš‚æ— è¯„ä»·</div>';
                return;
            }

            let html = '';
            comments.forEach(comment => {
                // ç”Ÿæˆæ˜Ÿçº§æ˜¾ç¤º
                let starsHtml = '';
                for (let i = 1; i <= 5; i++) {
                    starsHtml += `<span style="color: ${i <= comment.score ? '#ffc107' : '#ccc'}">â˜…</span>`;
                }

                html += `
                    <div class="comment-item" data-comment-id="${comment.id}">
                        <div class="comment-score-display">${starsHtml}</div>
                        <div class="comment-content">
                            ${comment.content}
                            <span class="comment-delete" onclick="deleteComment(${pointId}, '${comment.id}')">åˆ é™¤</span>
                        </div>
                        <div class="comment-time">${comment.time}</div>
                    </div>
                `;
            });

            commentListEl.innerHTML = html;
            // ç®¡ç†å‘˜çŠ¶æ€æ›´æ–°
            if (isAdmin) {
                commentListEl.classList.add('admin-show');
            }
        }

        // åˆ é™¤è¯„è®ºï¼ˆç®¡ç†å‘˜åŠŸèƒ½ï¼‰
        function deleteComment(pointId, commentId) {
            if (!isAdmin) {
                alert('åªæœ‰ç®¡ç†å‘˜å¯ä»¥åˆ é™¤è¯„è®ºï¼');
                return;
            }
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è¯„è®ºå—ï¼Ÿ')) {
                // è¿‡æ»¤æ‰è¦åˆ é™¤çš„è¯„è®º
                commentData[pointId] = commentData[pointId].filter(comment => comment.id !== commentId);
                // é‡æ–°åŠ è½½è¯„è®º
                loadComments(pointId);
            }
        }
    </script>
</body>
</html>
